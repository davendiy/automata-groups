\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{graphicx}
\usepackage[english]{babel}

% path to images
\graphicspath{ {../graphs/} }
\usepackage[left=2cm,right=2cm,
    top=2cm,bottom=2cm,bindingoffset=0cm]{geometry}
\title{ Solving the word problem in a Hanoi Tower Group }
\author{ David Zashkolny }
\date{March 2020}

\newtheorem{definition}{Definition}[section]

\newtheorem{statement}{Statement}[section]

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}

\begin{document}

\maketitle

\begin{abstract}
	This article presents investigation of algorithm for solving word problem in 
	the Hanoi Tower Group, its asymptotic in the worst case and the average one. Also some new abstraction and relations in the $H^{(3)}$ group are introduced here.
	
\end{abstract}

\section{Introduction}

\newpage

\section{Hanoi Tower Game and automaton groups}

Let's firstly describe briefly the Hanoi Tower Game. 

Fix an integer $k, \, k \ge 3$. The Hanoi Tower Game is played on k pegs, labeled by
$0, 1, ... k-1$, with n disks labeled by $1, 2, ... n$. All the $n$ disks have different
size and the disks' labels  reflect the relative size of each disk (the one labeled 
by $1$ is the smallest disk, the one with $2$ is the next smallest, etc.). A
configuration is (by definition) any placement of the $n$ disks on the k pegs in such 
a way that no disk is below a larger one (i.e. a size of the disks placed on any single 
peg is decreasing from the bottom to the top.). In a single step one may move the top 
disk from one peg to another as long as the newly obtained placement of disks is a 
configuration. Therefore, for any given two pegs $x$ and $y$ there is only one possible 
move which involves these two pegs (namely the smaller of the two top disks can be moved
to the other peg). Initially all disks are on peg $0$ and the object of the game is to
move all of them to peg 1 in the smallest possible numbers of steps.

\begin{figure}[h]
	\includegraphics[scale=0.5]{../graphs/hanoi_tower.jpg}
	\centering
\end{figure}

Now consider the free monoid $X^*$ of words over the alphabet $X = \{0,... k-1\}$. $X$ has a 
$k$-regular rooted tree structure in which the empty word is the root and the 
words of length $n$ constitute the level $n$ in the tree. The $k$ children of the vertex $u$ 
are the vertices $u x$ for $x = 0, ... k-1$. Denote this $k$-regular rooted tree by $T$
Any automorphism $g$ of $T$ can be (uniquely) decomposed as
$\pi_g (g_0, g_1, ... g_{k-1})$, where $\pi_g \in S_{k}$ is called \textit{root permutation} of 
$g$ and $g_x, \, x = 0, ... k-1$, are the tree automorphisms called the (first level) $sections$
of $g$. Thee root permutation $\pi_g$ and the sections $g_i$ are determined uniquely by the 
relation $g(xw) = \pi_g (x) g_x (w)$, for all $x \in X$ and $w \in X^*$.

For any permutation $\pi$ in $S_k$ define a $k$-ary tree automorphism $a = a_\pi$ by 
$a = \pi (a_0 , a_1 , ... , a_{k-1} )$, where $a_i$ is the
identity automorphism if $i$ is in the support of $\pi$ and $a_i = a$ otherwise. 
The action of the automorphism $a_{(ij)}$ on $T$ is given (recursively) by

$$ 
a_{(ij)}(iw) = jw, \quad a_{(ij)}(jw) = iw, \quad a_{(ij)}(xw) = xa_{(ij)}(w), \quad for \, x \notin \{i, j\}
$$

\textit{Hanoi Towers group on k pegs}, $k \ge 3$, is the group 
$H^{(k)} = \left\langle \left\{ a_{(ij)} | 0 \le i < j \le k - 1 \right\}\right\rangle$ of $k$-ary tree automorphisms
generated by the $a_{(ij)} ,\, 0 \le i < j \le k - 1$, corresponding to the transpositions in $S_k$. 

Note that the $n$-disk configurations are in bijective correspondence with the 
$k^n$ words of length $n$ over the alphabet $X = \{0, ... , k - 1\}$. Namely, the
word $x_1 ... x_n$ over $X$ corresponds to the unique configuration in which the
disk $i$, $i = 1, ... , n$, is placed on peg $x_i$.
The action of the automorphism $a_{(ij)}$ corresponds to a move between the pegs $i$ and $j$.

The group $H^{(k)}$ , $k \ge 3$, is an example of an automaton group. In general, 
an \textit{invertible} automaton is a quadruple $A = (S, X, \tau, \rho)$ in which $S$ is 
a finite set of states, $X$ a finite alphabet, $\tau : S \times X \rightarrow S$ 
a \textit{transition function} and $\pi : S \times X \rightarrow X$ an \textit{output function} such
that, for each state $s \in S$, the restriction 
$\pi_s = \pi(s,\cdot) : X \rightarrow X$ is a permutation in $S_X$ (see \cite{Auto}). 
The states of $A$ define recursively tree automorphisms by setting the permutation $\pi_s$ 
to be the root permutation of $s$ and the state $\tau (s, x)$ to be the section $s_x$ of $s$ at $x$. 
The group of tree automorphisms $G(A) = \left\langle s | s \in S \right \rangle$
generated by the automorphisms corresponding to the states of the invertible automaton $A$ is 
called the \textit{automaton group} of $A$. Invertible automata are often represented by diagrams 
such as the one on the left in Fig. \ref{automaton} corresponding to $H^{(4)}$. Each state s is labeled by 
the permutation $\pi_s$ and the labeled edges describe the transition function (if
$\tau (s, x) = t$ then there is an edge labeled $x$ connecting $s$ to $t$).

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.5]{../graphs/automaton_h4.jpg}
	\label{automaton}
	\caption{The automaton generating $H^{(4)}$}	

\end{figure}


\section{Trees}

Now let's take a look at the $H^{(3)}$ group. Hereafter define $G := H^{(3)}$ and 

$$ a := a_{(12)} = (1 2) (e, e, a_{(12)}) $$
$$ b := a_{(13)} = (1 3) (e, a_{(13)}, e) $$
$$ c := a_{(23)} = (2 3) (a_{(23)}, e, e) $$

Let's also introduce a new symbol $\delta$ which means a recursive call. Thus we
have such representation of the $G$'s atomic elements:

$$ e = () (\delta, \delta, \delta), \quad a = (1 2) (e, e, \delta), \quad 
b = (1 3)(e, \delta, e), \quad c = (2 3)(\delta, e, e)$$

Since now any element of the $G$ can be represented as a finite rooted 3-regular 
tree. 

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.13]{../graphs/a_b_c.png}
	\caption{Corresponding trees for atomic elements.}
	\label{a_b_c}	
\end{figure}

\newpage 

\section{Word problem and an algorithm description}




\section{The worst case}

*Here should be definition of the group $G$*

\theoremstyle{definition}
\begin{definition}
	 Function $\textbf{size} : G \rightarrow \mathbf{N} \cup \{0\}$ is defined recursively:
	
	\begin{equation} 
	size(w = \pi (w_1, w_2, w_3)) =
	\begin{cases}
	0, \quad  w = e \\
	0, \quad  w = \delta \quad \text{(reverse node)} \\
	|w| + size(w_1) + size(w_2) + size(w_3)\text{,} \quad \text{otherwise}
	\end{cases}
	\end{equation}
\end{definition}



Thus, $size(a) = size(b) = size(c) = 1$ by definition (Fig \ref{a_b_c}).

Similarly, $size(aa) = size(bb) = size(cc) = 2, \quad size(ab) = size(ac) = ... = size(bc) = 4$

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.25]{../graphs/aa.png}
	\includegraphics[scale=0.25]{../graphs/ab.png}
	\caption{The words from $\{a, b, c\}^2$ could be divided into 2 classes.}
	\label{second_order}
\end{figure}

\begin{definition}
	\textbf{abc-subset} $X \subset  \{a, b, c\}^*$ is such subset: 
	
	\begin{equation}
		 X = \left\{ (a^\pi b^\pi c^\pi)^k, \, (a^\pi b^\pi c^\pi)^k a^\pi, \, (a^\pi b^\pi c^\pi)^k a^\pi b^\pi  |\, k \in \mathbf{N}\cup\{0\}, \, \pi \in S_3   \right\}
	\end{equation}
	where $a^\pi$ means $S_3$ group action on set $\{a, b, c\}$; \\
	$(w_1 w_2 w_3)^k$ means repeating $k$ times of the expression in the parenthesis.
	\\
	
\end{definition}

\begin{lemma}
	$\forall w \in X \, w$ will have one of the next possible structures:
	$$\pi (w_1, w_2, e), \quad \pi(w_1, e, w_2), \quad \pi(e, w_1, w_2), $$
	where $w_1, w_2 \in X, \quad |w_1|, |w_2| \in
	\left\{
	\left\lfloor
	\frac{n}{2}
	\right\rfloor,
	\left\lceil
	\frac{n}{2}
	\right\rceil
	\right\}, \quad |w_1| + |w_2| = n, \quad n = |w|$
	\\
\end{lemma}

\begin{proof}
	Follows from definition of multiplication.
\end{proof}

Example: 

\includegraphics[scale=0.5]{../graphs/max_size_tree.png}

Therefore, here we have recursive formula for calculating function $size$ \textbf{(1)} for elements from $X$:

$$size(w \in X) = a (n) = a \left(
    \left\lfloor
        \frac{n}{2}
    \right\rfloor
\right)
+ a \left(
    \left\lceil
        \frac{n}{2}
    \right\rceil
\right) + n, \quad a(1) = 1, \quad a(0) = 0, \quad n = |w|
$$

\begin{statement}
	Exact form of function $a(n)$:
	\begin{equation}
		 a(n) = \begin{cases}
		 n \left(\left\lfloor \log_2 n + 1 \right\rfloor\right) + 2n - 2^{\left\lfloor\log_2 n\right\rfloor + 1}, \quad n > 0 \\
		 a(0) = 0
		 \end{cases}
	\end{equation}
\end{statement}

\begin{proof}
	$$ a (n+1) = n + 1 + a \left(
	\left\lfloor 
	\frac{n+1}{2}
	\right\rfloor 	
	\right)  + a \left(
	\left\lceil 
	\frac{n+1}{2}
	\right\rceil 
	\right) = n + 1 + a \left(
	\left\lfloor 
	\frac{n}{2} 
	\right\rfloor + 1
	\right) + a \left(
	\left\lceil 
	\frac{n}{2}
	\right\rceil 
	\right)
	$$
	
	$$\text{Let} \, b(n) := a(n + 1) - a(n) = 1 + a \left(
	\left\lfloor
	\frac{n}{2}
	\right\rfloor + 1
	\right) - a \left(
	\left\lfloor
	\frac{n}{2}
	\right\rfloor
	\right) \, \text{ - auxiliary recursion.
	}
	$$
	
	$$ b(n) = b\left(
	\left\lfloor
	\frac{n}{2}
	\right\rfloor
	\right) + 1, \quad b(2) = 4 \quad \Rightarrow \quad b(n) = \left\lfloor \log_2{n}\right\rfloor + 3
	$$
	
	$$
	a (n + 1) = b(n) + b(n-1) + ... + b(1) = 
	\sum_{1 \le k \le n} \left(
	\left\lfloor
	\log_2{k} + 3
	\right\rfloor	
	\right) \quad \Rightarrow \quad a(n) = 2(n - 1) + 
	\sum_{1 \le k \le n} \left(
	\left\lfloor
	\log_2{k} + 1
	\right\rfloor	
	\right)  = 
	$$
	$$
	= \begin{bmatrix}
	\text{amount of bits in all the} \\
	\text{numbers from} \,1 \,\text{to} \,N-1
	\end{bmatrix} = 2(n-1) + \sum_{i=1}^{\left\lfloor\log_2 n\right\rfloor} (n - 2^i) = n \left(
	\left\lfloor
	\log_2 n + 1
	\right\rfloor 
	\right) + 2n - 2^{\left\lfloor\log_2 n\right\rfloor + 1}
	$$
\end{proof}


\begin{theorem}
 	Elements from abc-subset X have maximum size, or in other words 
 	$$a (n) = \max (size(w) \,|\, w \in \{a,b,c\}^n)$$
\end{theorem}

\begin{proof}
	Induction on $n$.
	\begin{enumerate}
		\item Base: check examples of size calculation.
		\item Induction step:\\ 
		Let $\forall k < n \quad a (k) = \max (size(w) \,|\, w \in \{a,b,c\}^k)$. Hereafter we consider any $w \in \{a, b, c\}^{n}, \,\\ w = \pi (w_1, w_2, w_3), \, w_1, w_2, w_3 \in \{a, b, c\}^*\cup \{e\}$. Now we need to show that $size(w) \le a(n)$\\
		\\
		Let $ x_1 := |w_1|, \, x_2 := |w_2|, \, x_3 := |w_3|$. If $w$ has maximum size than due to induction hypothesis \\ 
		\begin{equation}
			size(w) \le a(x_1) + a(x_2) + a(x_3) + n
		\end{equation}
		 (we don't know whether any $w_1, w_2, w_3$ from $X$ could appear in $w$, so we use $\le$ symbol). Let's investigate how big this functional could be.\\
		\\
		Consider function $f(x) = x\log_2{x}$ instead of $a(x)$. We can do it because both $f(x)$ and $a(x)$ are monotonically increasing on $x \ge 1$. Thus, they are maximizing in similar way.
		\\
		Now we need to solve optimization problem 
		$$\max(f(x_1) + f(x_2) + f(x_3) \, | x_1>1,\, x_2>1,\, x_3>1,\, x_1 + x_2 + x_3 = n)$$
		$$F = f(x_1) + f(x_2) + f(x_3) = x_1 \log_2 x_1 + x_2 \log_2 x_2 + x_3 \log_3 x_3 = \Big[x_3 = n - x_1 - x_2\Big] =$$
		$$ = x_1 \log_2 x_1 + x_2 \log_2 x_2 + (n - x_1 - x_2) \log_2 (n-x_1 - x_2) = $$
		$$= x_1\log_2 x_1 + x_2 \log_2 x_2 + n \log_2 (n - x_1 - x_2) - x_1 \log_2 (n - x_1 - x_2) - x_2 \log_2(n - x_1 - x_2)$$
		$$\frac{\partial F}{\partial x_1} = \log_2 x_1 + \frac{1}{\ln 2} - \frac{n}{(n - x_1 - x_2)\ln 2} - \log_2 (n - x_1 - x_2) + \frac{x_1}{(n-x_1 - x_2)\ln 2} + \frac{x_2}{(n - x_1 - x_2) \ln 2}$$
		$$\frac{\partial F}{\partial x_2} = \log_2 x_2 + \frac{1}{\ln 2} - \frac{n}{(n - x_1 - x_2)\ln 2} - \log_2 (n - x_1 - x_2) + \frac{x_1}{(n-x_1 - x_2)\ln 2} + \frac{x_2}{(n - x_1 - x_2) \ln 2} $$
		If both $\dfrac{\partial F}{\partial x_1}$ and $\dfrac{\partial F}{\partial x_2}$ equal to zero then $\log_2 x_1 = \log_2 x_2 \, \Rightarrow \, x_1$ should be equal to $x_2$.
		\\
		Let's substitute $x = x_1 = x_2$ to F and differentiate it: 
		
		$$\frac{d F}{d x} = 2\log_2 x + \frac{2}{\ln 2} - \frac{2n}{(n-2x)\ln2} - 2\log_2 (n - 2x) + \frac{4x}{(n-2x)\ln 2} = 0$$
		Hence, $x = \dfrac{n}{3}$ - the single solution (Wolfram).
		Substituting it to $F$ we can find out that $x_1 = x_2 = x_3 = \dfrac{n}{3}$ - global minimum. Thus, F (therefore right part of \textbf{(4)}) reaches its maximum value on the bounds of its domain. 
		\\
		Now we are allowed to assume that $\exists i \, w_i = e$, because we know that otherwise
		$$size(w) \le a(x_1) + a(x_2) + a(x_3) + n \le a\left(
			\left\lfloor
				\frac{n}{2}
			\right\rfloor 
		\right) + a \left(
			\left\lceil
			\frac{n}{2}
			\right\rceil
		\right) + n$$
		It's easy to check that there are only 2 possible types of $w$ with one or more trivial element below: familiar to us $w \in X$ or such $w = z_1 z_2 z_3 ... z_n$ where there are at least one $i$ such that $z_i = z_{i+1}, \, \Rightarrow \, w$ could be reduced $\Rightarrow$ $size(w) < a(n)$ due to definition.
 	\end{enumerate}

\end{proof}



\section{Dual automaton}



\section{Average case}


\section{Hypotheses and comments}



\section{Generative function}

$$ T(z) = \sum_{w}size(w)z^{|w|} = \sum_{w_1}\sum_{w_2}\sum_{w_3}\left(s(w_1) + s(w_2) + s(w_3) +|w_1| + |w_2| + |w_3|\right)z^{|w_1| + |w_2| + |w_3|} =$$
$$=\sum_{w_1}\sum_{w_2}z^{|w_1| + |w_2|}\left((s(w_1) + s(w_2))\sum_{w_3}z^{|w_3|} + \sum_{w_3}s(w_3)z^{|w_3|} + (|w_1| + |w_2|)\sum_{w_3}z^{|w_3|} + \sum_{w_3}|w_3|z^{|w_3|}\right) = $$
$$= \left[\sum_{w}z^{|w|} = F(z), \quad \sum_{w}|w|z^{|w|} = z\sum_{w}|w|z^{|w| - 1} = zF'(z)\right] = $$
$$=\sum_{w_1}z^{|w_1|}\sum_{w_2}z^{|w_2|}\left((s(w_1) + s(w_2) + |w_1| + |w_2|)F(z) + T(z) + zF'(z)\right) = $$
$$ = \sum_{w_1}z^{|w_1|}\left(
			(T(z) + zF'(z))\sum_{w_2}z^{|w_2|} + F(z) \left( (s(w_1) + |w_1|)\sum_{w_2}z^{|w_2|} + \sum_{w_2}s(w_2)z^{|w_2|} + \sum_{w_2}|w_2|z^{|w_2|} \right)
\right) = $$
$$ = \sum_{w_1}z^{|w_1|} \left[ (T(z) + zF'(z))F(z) + F(z) ( (s(w_1) + |w_1|)F(z) + T(z) + zF'(z)) \right]  = $$
$$= \sum_{w_1}z^{|w_1|}\left[ T(z)F(z) + zF(z)F'(z) + F^2(z) (s(w_1) + |w_1|) + F(z)T(z) + zF(z)F'(z)   \right] = $$
$$ = \sum_{w_1}z^{|w_1|}\left[ 2T(z)F(z) + 2zF(z)F'(z) + F^2(z)(s(w_1) + |w_1|)  \right] = $$
$$ = 2T(z)F^2(z) + 2zF^2(z)F'(z) + F^2(z)T(z) + zF^2(z)F'(z) = 3T(z)F^2(z) + 3zF^2(z)F'(z)$$
$$\Rightarrow T(z) = \dfrac{3zF^2(z)F'(z)}{1 - 3F^2(z)}, \quad F(z) = \sum_{w}z^{|w|} = \sum_{n=1}^{\infty}x_n z^n$$

\begin{enumerate}
    \item $x_n = 3^n$
    $$F(z) = \sum_{n=1}^{\infty}3^nz^n = \sum_{n=1}^{\infty}(3z)^n = \dfrac{1}{1 - 3z} \quad \Rightarrow \quad T(z) = \dfrac{3z\dfrac{1}{(1 - 3z)^2} \dfrac{3}{(1 - 3z)^2}}{1 - 3\dfrac{1}{(1 - 3z)^2}} = \dfrac{9z}{81z^4 - 108z^3 + 27z^2+6z - 2} = \dfrac{P(z)}{Q(z)}$$
    Roots of Q(z): $\dfrac{1}{3}, \quad \dfrac{1}{3}, \quad \dfrac{1}{3} - \dfrac{1}{\sqrt{3}}, \quad \dfrac{1}{3} + \dfrac{1}{\sqrt{3}}$

    The root $\dfrac{1}{3} - \dfrac{1}{\sqrt{3}}$ has the least absolute value ($\sim0.24$). Thus, by theorem of asymptotic growth of the rational generative functions' coefficients

    $$[z^n] T(z) \sim C \left(\dfrac{3\sqrt{3}}{\sqrt{3} - 3}\right)^n \quad \Rightarrow \quad \dfrac{[z^n]T(z)}{3^n} \sim C \left(\dfrac{\sqrt{3}}{\sqrt{3} - 3}\right)^n$$

    \item $x_n = 3 * 2^{n-1}$
    $$F(z) = \sum_{n=1}^{\infty}3*2^{n-1}z^n = \frac{3}{2} \sum_{n=1}^{\infty}(2z)^n = \dfrac{3}{2 - 4z}, \quad \Rightarrow, \quad T(z) = \dfrac{3z \left(\dfrac{3}{2 - 4z}\right)^2 \dfrac{d}{dz}\left(\dfrac{3}{2 - 4z}\right)}{1 - 3\left(\dfrac{3}{2 - 4z}\right)^2} =$$
    $$=\dfrac{81z}{64z^4 - 128z^3 - 12z^2 + 76z - 23} = \dfrac{P(z)}{Q(z)}$$

    Roots of Q(z): $\dfrac{1}{2}, \dfrac{1}{2}, \dfrac{1}{2} - \dfrac{3\sqrt{3}}{4}, \dfrac{1}{2} + \dfrac{3\sqrt{3}}{4}$

    The root $\dfrac{1}{2}$ of multiplicity 2 has the least absolute value. Thus, by theorem of asymptotic growth of the rational generative functions' coefficients

    $$[z^n]T(z) \sim C(2)^n n, \quad C = 2 \dfrac{(-2)^2 * P(1/2)}{Q''(1/2)} = \dfrac{8 * 81/2}{24(32*1/4 - 32*1/2 - 1)} = -\dfrac{81}{42}$$

    $$\Rightarrow \quad \dfrac{[z^n]T(z)}{3*2^{n-1}} \sim \dfrac{-81 * 2^n * n}{42 * 3 * 2^{n-1}} = -\dfrac{9}{7}n$$



\end{enumerate}

\begin{thebibliography}{9}
	\bibitem{Hanoi1}
	Rostislav Grigorchuk, Zoran Sunik. Asymptotic aspects of Schreier graphs and Hanoi Towers groups. Department of Mathematics, Texas A\&M University, MS-3368, College Station, TX, 77843-3368, USA, 2006
	
	\bibitem{Hanoi2}
	Rostislav Grigorchuk, Zoran Sunik. SCHREIER SPECTRUM OF THE HANOI TOWERS GROUP ON THREE PEGS 2007
	
	\bibitem{Auto}
	R.I. Grigorchuk, V.V. Nekrashevich, V.I. SushchanskiÄ±, Automata, dynamical systems, and groups, Tr. Mat. Inst. Steklova 231 (2000) 134-214
	(Din. Sist., Avtom. i Beskon. Gruppy).
\end{thebibliography}


\end{document}
